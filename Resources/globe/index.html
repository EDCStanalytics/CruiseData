<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Globe Test</title>

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/topojson-client@3"></script>
    <script src="https://unpkg.com/d3-geo-projection@4"></script>
    <link rel="stylesheet" href="globe.css">
    <script src="globe.js" defer></script>
    <script  src="../JavaScripts/helpers.js" defer></script>
    <script  src="../JavaScripts/callData.js" defer></script>
    <script  src="../JavaScripts/powerData.js" defer></script>

    <script  src="../JavaScripts/header.js" defer></script>

    
    <script  src="../JavaScripts/chartEmbed.js" defer></script>
    <script src="../JavaScripts/focus.js" defer></script>
    
<!-- This installs Font Awesome-->
        <script src="https://kit.fontawesome.com/14dbedf33a.js" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  
</head>

<header class="hBar" id="theHeaderBar">
  <h1>Cruise Data Portal</h1>

  <nav>
    <ul id="navBarItems">
      <li>Summary</li>
      <li>Vessels</li>
      <li>Services</li>
    </ul>
  </nav>

  <!-- Help icon -->
  <i class="fa-regular fa-circle-question" title="Help"></i>

  <!-- Export icon (make it a real clickable anchor with the ID your script uses) -->
  
    <i id ="download-combo"  class="fa-solid fa-database" style="cursor:pointer;" title="Export Data "></i>
  </a>
</header>

<!-- Wire up the click AFTER the element exists -->
<script>

document.addEventListener('DOMContentLoaded', () => {
  const dbIcon = document.getElementById('download-combo');
  const modal = document.getElementById('exportChoiceModal');
  const btnClose = document.getElementById('exportModalCloseBtn');

  // Show popup when clicking the database icon
  dbIcon?.addEventListener('click', () => {
    if (typeof modal.showModal === 'function') {
      modal.showModal();
    } else {
      modal.setAttribute('open', '');
    }
  });

  // Close popup when clicking the close button
  btnClose?.addEventListener('click', () => {
    if (typeof modal.close === 'function') {
      modal.close();
    } else {
      modal.removeAttribute('open');
    }});

  //  close when clicking outside the modal content
  modal?.addEventListener('click', (e) => {
    const content = modal.querySelector('.export-modal__content');
    if (!content) return;
    const rect = content.getBoundingClientRect();
    const inside = e.clientX >= rect.left && e.clientX <= rect.right &&
                   e.clientY >= rect.top && e.clientY <= rect.bottom;
    if (!inside) {
      if (typeof modal.close === 'function') modal.close();
      else modal.removeAttribute('open');
    }
  });
});

 document.addEventListener('DOMContentLoaded', () => {
    const trigger = document.getElementById('exportExcelBtn');
    if (!trigger) {
      console.error('download-combo link not found');
      return;
    }
    trigger.addEventListener('click', async (e) => {
      e.preventDefault();
      try {
       const count = await CruiseExporter.downloadAllSheets('CruiseData.xlsx');
        console.log('Download started. Rows:', count);
      } catch (err) {
        console.error('Export failed:', err);
        alert('Export failed: ' + err.message);
      }
    });
  }
  
);

</script>

<!-- ✅ Scripts go OUTSIDE the header and load in correct order -->

<script src="https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js" ></script>
<script src="../JavaScripts/export.js" defer></script>
<!-- Font Awesome 6 CSS (for fa-solid / fa-regular icons). Put this in <head> ideally. -->
<link rel="stylesheet" ></link>

</header>

  <body>
    <div id="earth"></div>
  
    <div id="dataSpace">
      <div id="berthSpace"></div>

      <div id="cardSpace"></div>

      <div id="D3andME">

        <div class="kpiBucket" id="leftChartContainer">
          
          <div class="baseStats">

          </div>
          
          <div id="leftRadialChart" class="radial_anchor"></div>
          <div id="leftCentralChart"></div>
          <div class="glass" aria-hidden="true"></div>

        </div>
        
        <div class="kpiBucket" id="rightChartContainer">
          
          <div class="baseStats">

          </div>
        
          <div id="rightRadialChart" class="radial_anchor"></div>
          <div id="rightCentralChart"></div>
          <div class="glass" aria-hidden="true"></div>

        </div>
      </div>
    </div>

    <!-- Popup Modal -->
<dialog id="exportChoiceModal" class="export-modal">
  <form method="dialog" class="export-modal__content">
    <div class="export-modal__header">
      <button type="button" id="exportModalCloseBtn" class="export-modal__close" aria-label="Close">✕</button>
    </div>
    <p>Please choose a format to export:</p>
    <div class="export-modal__actions">
      <button type="button" id="exportExcelBtn" class="btn btn-primary">Excel (.xlsx)</button>
      <button type="button" id="exportPdfBtn" class="btn btn-secondary">PDF (.pdf)</button>
    </div>
  </form>
</dialog>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const pdfBtn = document.getElementById('exportPdfBtn');
  if (!pdfBtn) {
    console.error('PDF button not found');
    return;
  }
  pdfBtn.addEventListener('click', function() {
    window.open(
      'https://raw.githubusercontent.com/EDCStanalytics/CruiseData/main/Actuals/Shore-Power-Connections-2017-to-11-30-25.pdf'
    );
  });
});
</script>

  </body>

</html>
